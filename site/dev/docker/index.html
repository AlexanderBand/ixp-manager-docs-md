<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Docker - IXP Manager Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Docker";
    var mkdocs_page_input_path = "dev/docker.md";
    var mkdocs_page_url = "/dev/docker/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> IXP Manager Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../install/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/automated-script/">Automated Script</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/maint-mode/">Maintenance Mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/manually/">Manual Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrading/">Upgrading</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/upgrade-v3/">Upgrade From v3</a>
                </li>
                <li class="">
                    
    <a class="" href="../../install/runtime/">Runtime Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General Usage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../usage/customers/">Customers / Members</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/interfaces/">Customer Connections</a>
                </li>
                <li class="">
                    
    <a class="" href="../../usage/users/">Users & Contacts</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../features/api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/as112/">AS112</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/contact-groups/">Contact Groups</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/patch-panels/">Cross Connects</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/dns-arpa/">DNS / ARPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/grapher/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/helpdesk/">Helpdesk Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/irrdb/">IRRDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/ixf-export/">IX-F Member Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/layer2-addresses/">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/layer2-addresses/">MAC Addresses</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/mailing-lists/">Mailing List Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/nagios/">Nagios</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/patch-panels/">Patch Panels</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/reseller/">Reseller Functionality</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/route-collectors/">Route Collectors</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/route-servers/">Route Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/routers/">Router Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/skinning/">Skinning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/smokeping/">Smokeping</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/static-content/">Static Content</a>
                </li>
                <li class="">
                    
    <a class="" href="../../features/tacacs/">TACACS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../api/">API</a>
                </li>
                <li class="">
                    
    <a class="" href="../ci/">Continuous Integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../cla/">Contributer License Agreement</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Docker</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#docker">Docker</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#tldr-guide-to-get-docker-running">TL;DR Guide to Get Docker Running</a></li>
        
            <li><a class="toctree-l4" href="#general-overview">General Overview</a></li>
        
            <li><a class="toctree-l4" href="#useful-docker-commands">Useful Docker Commands</a></li>
        
            <li><a class="toctree-l4" href="#development-use">Development Use</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../docs/">Documentation</a>
                </li>
                <li class="">
                    
    <a class="" href="../frontend-crud/">Frontend CRUD</a>
                </li>
                <li class="">
                    
    <a class="" href="../grapher/">Grapher</a>
                </li>
                <li class="">
                    
    <a class="" href="../helpders/">Helpers</a>
                </li>
                <li class="">
                    
    <a class="" href="../looking-glass/">Looking Glass</a>
                </li>
                <li class="">
                    
    <a class="" href="../vagrant/">Vagrant</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">IXP Manager Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Docker</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/inex/ixp-manager-docs-md/edit/master/docs/dev/docker.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link"></a></h1>
<p>For development purposes, we have both Docker and <a href="../vagrant/">Vagrant</a> build files.</p>
<p>This page on Docker for IXP Manager development should be read in conjunction with the <a href="https://github.com/inex/ixp-manager-docker">official IXP Manager Docker repository</a>. While that repository is not for development purposes, the terminology and container descriptions apply here also.</p>
<h2 id="tldr-guide-to-get-docker-running">TL;DR Guide to Get Docker Running<a class="headerlink" href="#tldr-guide-to-get-docker-running" title="Permanent link"></a></h2>
<p>If you want to get IXP Manager with Docker up and running quickly, follow these steps:</p>
<ol>
<li>Install Docker (see: https://www.docker.com/community-edition)</li>
<li>
<p>Clone IXP Manager to a directory:</p>
<p><div class="highlight"><pre><span></span>git clone https://github.com/inex/IXP-Manager.git ixpmanager
<span class="nb">cd</span> ixpmanager
</pre></div>

3. Copy the stock Docker/IXP Manager configuration file and default database:</p>
<div class="highlight"><pre><span></span>cp .env.docker .env
cp tools/docker/containers/mysql/docker.sql.dist tools/docker/containers/mysql/docker.sql
</pre></div>


</li>
<li>
<p>Spin up the Docker containers</p>
<div class="highlight"><pre><span></span>docker-compose -p ixpm up
</pre></div>


</li>
<li>
<p>Access IXP Manager on: http://localhost:8880/</p>
</li>
<li>
<p>Log in with one of the following username / passwords:</p>
</li>
<li>
<p>Admin user: <code>docker / docker01</code></p>
</li>
<li>Customer Admin: <code>as112admin / as112admin</code></li>
<li>Customer User: <code>as112user / as112user</code></li>
</ol>
<h2 id="general-overview">General Overview<a class="headerlink" href="#general-overview" title="Permanent link"></a></h2>
<p>As the IXP Manager ecosystem grows, it becomes harder and harder to maintain ubiquitous development environments. Docker is ideally suited to solving these issues.</p>
<p>The multi-container Docker environment for developing IXP Manager builds an IXP Manager system which includes:</p>
<ul>
<li>a custom MySQL database container (from <a href="https://hub.docker.com/_/mysql/">mysql/5.7</a>).</li>
<li>the complete IXP Manager application build on the <a href="https://hub.docker.com/r/library/php/">php/7.0-apache</a> base. This has been preconfigured with some customers, routers, switches, etc. to match the following containers.</li>
<li>two emulated switches via SNMP endpoints (using the excellent <a href="http://snmplabs.com/snmpsim/">SNMP Agent Simulator</a> via <a href="https://hub.docker.com/r/tandrup/snmpsim/">tandrup/snmpsim</a>);</li>
<li>a mail trap with a web-based frontend to capture and analyse all emails sent by IXP Manager (thanks to <a href="https://hub.docker.com/r/schickling/mailcatcher/">schickling/mailcatcher</a>).</li>
<li>a mrtg container to query the switches and build up mrtg log files / graphs (via <a href="https://hub.docker.com/r/cityhawk/mrtg/">cityhawk/mrtg</a>).</li>
<li>a Bird-based route server pre-configured for 3 x IPv4 and 2 x IPv6 sessions. This also includes our <a href="https://github.com/inex/birdseye">Bird's Eye</a> looking glass which has been integrated into <em>rs1</em> container and configured into the IXP Manager container.</li>
<li>five Bird-based route server clients complete with routes and a route server session.</li>
</ul>
<h2 id="useful-docker-commands">Useful Docker Commands<a class="headerlink" href="#useful-docker-commands" title="Permanent link"></a></h2>
<p>The following are a list of Docker commands that are useful in general but also specifically for the IXP Manager Docker environment.</p>
<p>Note that in our examples, we set the Docker project name to <code>ixpm</code> and so that prefix is used in some of the below. We also assume that only one IXP Manager Docker environments is running and so we complate Docker container names with <code>_1</code>.</p>
<div class="highlight"><pre><span></span><span class="c1"># show all running containers</span>
docker ps

<span class="c1"># show all containers - running and stopped</span>
docker ps -a

<span class="c1"># stop a container:</span>
docker stop &lt;container&gt;

<span class="c1"># start a container:</span>
docker start &lt;container&gt;

<span class="c1"># we create a &#39;ixpmanager&#39; network. Sometimes you need to delete this when</span>
<span class="c1"># stopping / starting the environment</span>
docker network rm ixpm_ixpmanager

<span class="c1"># you can copy files into a docker container via:</span>
docker cp test.sql ixmp_mysql_1:/tmp
<span class="c1"># where &#39;ixmp_mysql_1&#39; is the container name.</span>
<span class="c1"># reverse it to copy a file out:</span>
docker cp ixmp_mysql_1:/tmp/dump.sql .

<span class="c1"># I use two useful aliases for stopping and removing all containers:</span>
<span class="nb">alias</span> docker-stop-all<span class="o">=</span><span class="s1">&#39;docker stop $(docker ps -a -q)&#39;</span>
<span class="nb">alias</span> docker-rm-all<span class="o">=</span><span class="s1">&#39;docker rm $(docker ps -a -q)&#39;</span>

<span class="c1"># You can also remove all unused (unattached) volumes:</span>
docker volume prune
<span class="c1"># WARNING: you might want to check what will be deleted with:</span>
docker volume ls -f <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span>
</pre></div>


<h2 id="development-use">Development Use<a class="headerlink" href="#development-use" title="Permanent link"></a></h2>
<p>As above, please note that in our examples, we set the Docker project name to <code>ixpm</code> and so that prefix is used in some of the below. We also assume that only one IXP Manager Docker environments is running and so we complete Docker container names with <code>_1</code>.</p>
<p>For most routine development use, you only need two containers usually:</p>
<div class="highlight"><pre><span></span>docker-compose -p ixpm up mysql www
</pre></div>


<p>If you are sending emails as part of your development process, include the mail catcher:</p>
<div class="highlight"><pre><span></span>docker-compose -p ixpm up mysql www mailcatcher
</pre></div>


<h3 id="mysql-database">MySQL Database<a class="headerlink" href="#mysql-database" title="Permanent link"></a></h3>
<p>When the mysql container builds, it pre-populates the database with the contents of the SQL file found at <code>tools/docker/containers/mysql/docker.sql</code>. This is not present by default and is ignored by Git (to ensure you do not accidentally commit a production database!).</p>
<p>A default SQL database is bundled and should be placed in this location via:</p>
<div class="highlight"><pre><span></span>cp tools/docker/containers/mysql/docker.sql.dist tools/docker/containers/mysql/docker.sql
</pre></div>


<p>You can put your own database here also. If you do, you will need to rebuilt the mysql contain:</p>
<div class="highlight"><pre><span></span> docker-compose build mysql
 <span class="sb">```</span>

 You can access the MySQL database via:

<span class="sb">```</span>sh
docker <span class="nb">exec</span> -it ixpm_mysql_1 mysql -i ixpmanager
</pre></div>


<p>And you can get shell access to the container with:</p>
<div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it ixpm_mysql_1 bash
</pre></div>


<p>### Web Server</p>
<p>Note that the <code>www</code> container mounts the IXP Manager development directory under <code>/srv/ixpmanager</code>. This means all local code changes are immediately reflected on the Docker web server.</p>
<p>The Dockerfile used to build the <code>www</code> container can be found at <code>tools/docker/containers/www/Dockerfile</code>.</p>
<p>You can access the container with:</p>
<div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it ixpm_www_1 bash
</pre></div>


<h3 id="mailcatcher">Mailcatcher<a class="headerlink" href="#mailcatcher" title="Permanent link"></a></h3>
<p>We include a mailcatcher container which catches all emails IXP Manager sends and displays them on a web frontend. Ensure this container is started by either:</p>
<div class="highlight"><pre><span></span><span class="c1"># start all containers:</span>
docker-compose -p ixpm up
<span class="c1"># start mailcatcher with (at least) mysql and www:</span>
docker-compose -p ixpm up mysql www mailcatcher
</pre></div>


<p>The <code>.env.docker</code> config contains the following SMTP / mail settings which ensure emails get send to the mailcatcher:</p>
<div class="highlight"><pre><span></span>MAIL_HOST=172.30.201.11
MAIL_PORT=1025
</pre></div>


<p>You can then view emails sent on: http://localhost:1080/</p>
<h3 id="emulating-switches">Emulating Switches<a class="headerlink" href="#emulating-switches" title="Permanent link"></a></h3>
<p><code>ixpm_switch1_1</code> and <code>ixpm_switch2_1</code> emulate switches by replaying SNMP dumps from real INEX switches (with some sanitisation). The OIDs for traffic have been replaced with a dynamic function to give varying values.</p>
<p>From the <code>www</code> container, you can interact with these via:</p>
<div class="highlight"><pre><span></span>$ docker exec -it ixpm_www_1 bash
# ping switch1
...
64 bytes from switch1 (172.30.201.60): icmp_seq=1 ttl=64 time=0.135 ms
...
# ping switch2
...
64 bytes from switch2 (172.30.201.61): icmp_seq=1 ttl=64 time=0.150 ms
...


# snmpwalk -On -v 2c -c switch1 switch1 .1.3.6.1.2.1.1.5.0
.1.3.6.1.2.1.1.5.0 = STRING: &quot;switch1&quot;
# snmpwalk -On -v 2c -c switch2 switch2 .1.3.6.1.2.1.1.5.0
.1.3.6.1.2.1.1.5.0 = STRING: &quot;switch2&quot;
</pre></div>


<p>You'll note from the above that the hostnames <code>switch1</code> and <code>switch2</code> work from the <code>www</code> container. Note also that the SNMP community is the hostname (<code>switch1</code> or <code>switch2</code> as appropriate).</p>
<p>The packaged database only contains <code>switch1</code>. This allows you can add the second switch via http://localhost:8880/switch/add-by-snmp by setting the hostname and community to <code>switch2</code>.</p>
<p>If you want to add new customers for testing, add <code>switch2</code> and then use interfaces <code>Ethernet 2, 8, 13</code> and <code>6 and 7</code> as a lag as these have been preset to provide dynamic stats.</p>
<h3 id="route-server-and-clients">Route Server and Clients<a class="headerlink" href="#route-server-and-clients" title="Permanent link"></a></h3>
<p>The containers include a working route server (<code>ixpm_rs1_1</code>) with 3 IPv4 clients (<code>ixpm_cust-as112_1</code>, <code>ixpm_cust-as42_1</code>, <code>ixpm_cust-as1213_1</code>) and and 2 IPv6 clients (<code>ixpm_cust-as1213-v6_1</code>, <code>ixpm_cust-as25441-v6_1</code>). IXP Manager also includes a working looking glass for this with Bird's Eye installed on the route server.</p>
<p>You can access the Bird BGP clients on the five sample customers using the following examples:</p>
<div class="highlight"><pre><span></span><span class="c1"># access Bird command line interface:</span>
docker <span class="nb">exec</span> -it ixpm_cust-as112_1 birdc

<span class="c1"># run a specific Bird command</span>
docker <span class="nb">exec</span> -it ixpm_cust-as112_1 birdc show protocols
</pre></div>


<p>The route server runs an IPv4 and an IPv6 daemon. These can be accessed via the looking glass at http://127.0.0.1:8880/lg or on the command line via:</p>
<div class="highlight"><pre><span></span><span class="c1"># ipv4 daemon:</span>
docker <span class="nb">exec</span> -it ixpm_rs1_1 birdc -s /var/run/bird/bird-rs1-ipv4.ctl

<span class="c1"># ipv6 daemon:</span>
docker <span class="nb">exec</span> -it ixpm_rs1_1 birdc6 -s /var/run/bird/bird-rs1-ipv6.ctl
</pre></div>


<p>In this container, Bird's Eye can be found at <code>/srv/birdseye</code> with the web server config under <code>/etc/lighttpd/lighttpd.conf</code>.</p>
<p>We include the IXP Manager scripts for updating the route server configuration and reconfiguring Bird:</p>
<div class="highlight"><pre><span></span><span class="c1"># get shell access to the container</span>
docker <span class="nb">exec</span> -it ixpm_rs1_1 bash

<span class="c1"># all scripts under the following directory</span>
<span class="nb">cd</span> /usr/local/sbin/

<span class="c1"># reconfigure both daemons:</span>
./api-reconfigure-all-v4.sh

<span class="c1"># reconfigure a specific daemon with verbosity:</span>
./api-reconfigure-v4.sh -d -h rs1-ipv4
</pre></div>


<h3 id="mrtg-grapher">Mrtg / Grapher<a class="headerlink" href="#mrtg-grapher" title="Permanent link"></a></h3>
<p>For developing / testing Grapher with Mrtg, we include a container that runs Mrtg via cron from a pre-configured <code>mrtg.conf</code> file.</p>
<p><strong>NB: please ensure to update the <code>GRAPHER_BACKENDS</code> option in <code>.env</code> so it includes <code>mrtg</code> as follows:</strong></p>
<div class="highlight"><pre><span></span>GRAPHER_BACKENDS=&quot;mrtg|dummy&quot;
</pre></div>


<p>The configuration file matches the <code>docker.sql</code> configuration and can be seen in the IXP Manager source directory at <code>tools/docker/mrtg/mrtg.cfg</code>.</p>
<p>You can access the Mrtg container via:</p>
<div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it ixpm_mrtg_1 sh
</pre></div>


<p>We also install a script in the root directory of the container that will pull a new configuration from IXP Manager. Run it via:</p>
<div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it ixpm_mrtg_1 sh
<span class="nb">cd</span> /
./update-mrtg-conf.sh

<span class="c1"># or without entering the container:</span>
docker <span class="nb">exec</span> -it ixpm_mrtg_1 /update-mrtg-conf.sh
</pre></div>


<p>It will replace <code>/etc/mrtg.conf</code> for the next cron run. It also sets the configuration not to run as a daemon as cron is more useful for development.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../docs/" class="btn btn-neutral float-right" title="Documentation">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cla/" class="btn btn-neutral" title="Contributer License Agreement"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>&copy; 2017, Internet Neutral Exchange Association Company Limited by Guarantee (INEX).<br><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>&nbsp;This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/inex/ixp-manager-docs-md" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../cla/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../docs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
